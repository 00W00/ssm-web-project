<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.nanyin.mapper.NavBarMapper">

    <select id="findNavBarByUserId" parameterType="java.lang.Integer" resultType="com.nanyin.entity.NavBar">
        SELECT s.id,s.name,s.href,s.parent_nav_id,s.icon,s.is_deleted,s.ord,s.spread
        FROM s_nav_bar s
        LEFT JOIN r_nav_auth r on r.nav_id = s.id
        LEFT JOIN auth a on a.id = r.auth_id
        LEFT JOIN r_user_auth ra on ra.auth_id = a.id
        LEFT JOIN `user` user on user.id = ra.user_id WHERE user.id=#{userId}
    </select>

    <select id="findParentNode" resultType="com.nanyin.entity.NavBar" parameterType="java.lang.Integer">
        SELECT s.id,s.name,s.href,s.parent_nav_id,s.icon,s.is_deleted,s.ord,s.spread
        from s_nav_bar s
        LEFT JOIN r_nav_auth r on r.nav_id = s.id
        LEFT JOIN auth a on a.id = r.auth_id
        LEFT JOIN r_user_auth ra on ra.auth_id = a.id
        LEFT JOIN `user` user on user.id = ra.user_id
        where s.parent_nav_id is NULL and s.is_deleted=0 AND user.id=#{userId} ORDER BY s.ord;
    </select>

    <select id="findChildNode" resultType="com.nanyin.entity.NavBar" parameterType="java.util.Map">
      select s.id,s.name,s.href,s.parent_nav_id,s.icon,s.is_deleted,s.ord,s.spread
      from s_nav_bar s
      LEFT JOIN r_nav_auth r on r.nav_id = s.id
      LEFT JOIN auth a on a.id = r.auth_id
      LEFT JOIN r_user_auth ra on ra.auth_id = a.id
      LEFT JOIN `user` user on user.id = ra.user_id
      where s.parent_nav_id = #{parentId} and s.is_deleted=0 AND user.id=#{userId}  ORDER BY s.ord
    </select>

    <!--<cache type="org.mybatis.caches.ehcache.LoggingEhcache" >-->
        <!--<property name="timeToIdleSeconds" value="3600"/>-->
        <!--<property name="timeToLiveSeconds" value="3600"/>-->
        <!--<property name="maxEntriesLocalHeap" value="1000"/>-->
        <!--<property name="maxEntriesLocalDisk" value="10000000"/>-->
        <!--<property name="memoryStoreEvictionPolicy" value="LRU"/>-->
    <!--</cache>-->

</mapper>